openapi: 3.0.0
info:
  title: Jira Analytics API
  description: Node.js server for analyzing Jira issues, workflows, and time metrics.
  version: 1.0.0

servers:
  - url: http://localhost:3000
    description: Local Development Server

# Reusable header parameters
components:
  parameters:
    JiraUrl:
      in: header
      name: x-jira-url
      schema:
        type: string
        example: "https://your-domain.atlassian.net"
      required: true
      description: The base URL of the Jira instance.
    JiraEmail:
      in: header
      name: x-jira-email
      schema:
        type: string
        format: email
        example: "user@example.com"
      required: true
      description: The email address associated with the Jira account.
    JiraApiKey:
      in: header
      name: x-jira-api-key
      schema:
        type: string
      required: true
      description: The Atlassian API Token.

paths:
  /api/projects:
    get:
      operationId: listProjects
      summary: List all Jira projects
      description: Fetches a list of all projects visible to the user.
      parameters:
        - $ref: '#/components/parameters/JiraUrl'
        - $ref: '#/components/parameters/JiraEmail'
        - $ref: '#/components/parameters/JiraApiKey'
      responses:
        '200':
          description: List of projects retrieved successfully.
        '400':
          description: Missing headers.
        '500':
          description: Jira API error.

  /api/data-understanding:
    get:
      operationId: getDataUnderstanding
      summary: Get issue statistics and data quality metrics
      description: Aggregates total issues, groups by type/status/assignee, and flags missing fields.
      parameters:
        - $ref: '#/components/parameters/JiraUrl'
        - $ref: '#/components/parameters/JiraEmail'
        - $ref: '#/components/parameters/JiraApiKey'
        - name: projectKey
          in: query
          schema:
            type: string
          required: true
          description: The Jira Project Key (e.g., WEB, PROJ).
        - name: startAt
          in: query
          schema:
            type: integer
            default: 0
        - name: maxResults
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Aggregated data metrics returned.

  /api/time-analysis:
    get:
      operationId: getTimeAnalysis
      summary: Analyze issue aging and spikes
      description: Calculates average age, time to resolve, and identifies stalled issues.
      parameters:
        - $ref: '#/components/parameters/JiraUrl'
        - $ref: '#/components/parameters/JiraEmail'
        - $ref: '#/components/parameters/JiraApiKey'
        - name: projectKey
          in: query
          required: true
          schema: 
            type: string
        - name: startAt
          in: query
          schema: 
            type: integer
            default: 0
        - name: maxResults
          in: query
          schema: 
            type: integer
            default: 50
        - name: x-stalled-days
          in: header
          schema:
            type: integer
            default: 14
          required: false
          description: Number of days without update to consider an issue "stalled".
      responses:
        '200':
          description: Time-based statistics returned.

  /api/workflow-analysis:
    get:
      operationId: getWorkflowAnalysis
      summary: Analyze transitions and bottlenecks
      description: Parses issue changelogs to determine time spent in status and reopen patterns.
      parameters:
        - $ref: '#/components/parameters/JiraUrl'
        - $ref: '#/components/parameters/JiraEmail'
        - $ref: '#/components/parameters/JiraApiKey'
        - name: projectKey
          in: query
          required: true
          schema: 
            type: string
        - name: startAt
          in: query
          schema: 
            type: integer
            default: 0
        - name: maxResults
          in: query
          schema: 
            type: integer
            default: 50
      responses:
        '200':
          description: Workflow analysis returned.